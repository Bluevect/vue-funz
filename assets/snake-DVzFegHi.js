import{q as u,c as v}from"./index-0W-_GK_W.js";const r=u({bg:"gray",snakeColor:"#304c9a",foodColor:"orange",killedColor:"red",initialDir:1,time:150}),l=u({width:20,height:20,blockWidth:25,blockHeight:25}),d=v(()=>l.width*l.height);let g=()=>{},k=()=>{},b=()=>{};function M(n){g=n}function w(n){k=n}function C(n){b=n}function o(n,t,e){const{width:a,blockWidth:h,blockHeight:i}=l;e.fillStyle=t;const s=n%a*h,c=Math.floor(n/a)*i;e.fillRect(s+1,c+1,h-1,i-1)}function F(n,t){for(let e=0;e<d.value;e++)o(e,n,t)}class m{blocks=[];availableMap=[];dir;changeFinished=!0;cxt;foodPos=0;constructor(t,...e){const{snakeColor:a,initialDir:h}=r;this.cxt=t,this.dir=h;for(let i=0;i<e.length;i++)o(e[i],a,t),this.blocks.push(e[i]);for(let i=0;i<d.value;i++)e.indexOf(i)==-1&&this.availableMap.push(i);this.generateFood()}length(){return this.blocks.length}getHead(){return this.blocks[this.length()-1]}direction(t){return t&&(this.changeFinished=!1,this.dir=t),this.dir}move(){const{width:t}=l,{killedColor:e,snakeColor:a,bg:h}=r,i=this.getHead(),s=i+this.dir;if(s%t==0&&this.dir==1||(s+1)%t==0&&this.dir==-1||s<0||s>=d.value||this.blocks.indexOf(s)!=-1)return o(i,e,this.cxt),0;if(s==this.foodPos){g(),this.blocks.push(s);const p=this.availableMap.indexOf(s);return this.availableMap.splice(p,1),o(s,a,this.cxt),this.generateFood(),this.changeFinished=!0,1}this.blocks.push(s);const c=this.availableMap.indexOf(s);this.availableMap.splice(c,1),o(s,a,this.cxt);const f=this.blocks.shift();return this.availableMap.push(f),o(f,h,this.cxt),this.changeFinished=!0,1}generateFood(){const{foodColor:t}=r,e=Math.floor(Math.random()*this.availableMap.length),a=this.availableMap[e];this.foodPos=a,o(a,t,this.cxt)}}class O{interval=null;snake=null;cxt;constructor(t){this.cxt=t}start(){k(),this.snake=new m(this.cxt,0,1,2);const t=this.snake;let e=1;this.interval=setInterval(()=>{e=t.move(),e==0&&this.gameOver()},r.time)}gameOver(){this.snake=null,b(),clearInterval(this.interval)}getChangeFinished(){if(!this.snake)throw new Error("Game is not running!");return this.snake.changeFinished}direction(t){if(!this.snake)throw new Error("Game is not running!");return t?(this.snake.direction(t),t):this.snake.direction()}}export{O as S,w as a,C as b,r as c,F as f,l as m,M as o};
